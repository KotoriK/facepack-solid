{"version":3,"file":"renderer.js","sources":["../src/renderer/renderer.ts"],"sourcesContent":["import { FacePackage } from \"../FacePackage\"\nimport { REG_IMAGE } from \"../util/isImage\"\nimport { processTemplate } from \"../util/template\"\n/**\n * 可选字段\n */\ninterface FaceRendererPropOptional {\n    imgClassName?: string\n    imgInlineStyle?: string\n    leftBracket?: string\n    rightBracket?: string\n}\nexport interface FaceRendererProp extends FaceRendererPropOptional {\n    facePackages: Array<FacePackage>\n}\n\n/**\n * 创建渲染器\n * @param param0 \n * @returns \n */\nexport function createFaceRenderer(\n    {\n        facePackages,\n        imgClassName = '',\n        imgInlineStyle = 'max-height:6vh;',\n        leftBracket = ':',\n        rightBracket = ':'\n    }: FaceRendererProp) {\n    const map: Record<string, string> = {}\n    for (const pack of facePackages) {\n        for (const face of pack.faces) {\n            map[`${pack.id}.${face.id}`] = face.url\n        }\n    }\n    const replacePlaceHolder = (placeHolder: string) => {\n        const url = map[placeHolder]\n        if (url) {\n            if (url.match(REG_IMAGE)) {\n                return `<img class=\"${imgClassName}\" src=\"${url}\" style=\"${imgInlineStyle}\" alt=\"${leftBracket}${placeHolder}${rightBracket}\"/>`\n            } else {\n                return `<video class=\"${imgClassName}\" src=\"${url}\" style=\"${imgInlineStyle}\" title=\"${leftBracket}${placeHolder}${rightBracket}\" playsinline muted loop autoplay></video>`\n            }\n        } else {\n            return `${leftBracket}${placeHolder}${rightBracket}`\n        }\n    }\n    const renderText = (text: string) => processTemplate(leftBracket, rightBracket, replacePlaceHolder, text)\n\n    return function renderFace(displayOn: Element | string) {\n        if (typeof displayOn === 'string') {\n            return renderText(displayOn)\n        } else {\n            const raw = displayOn.innerHTML\n            const result = renderText(raw)\n            if (result !== raw) displayOn.innerHTML = result\n        }\n    }\n}"],"names":[],"mappings":";;;AAqBO,SAAS,kBACZ,CAAA;AAAA,EACI,YAAA;AAAA,EACA,YAAe,GAAA,EAAA;AAAA,EACf,cAAiB,GAAA,iBAAA;AAAA,EACjB,WAAc,GAAA,GAAA;AAAA,EACd,YAAe,GAAA,GAAA;AACnB,CAAqB,EAAA;AACrB,EAAA,MAAM,MAA8B,EAAC,CAAA;AACrC,EAAA,KAAA,MAAW,QAAQ,YAAc,EAAA;AAC7B,IAAW,KAAA,MAAA,IAAA,IAAQ,KAAK,KAAO,EAAA;AAC3B,MAAI,GAAA,CAAA,CAAA,EAAG,KAAK,EAAE,CAAA,CAAA,EAAI,KAAK,EAAE,CAAA,CAAE,IAAI,IAAK,CAAA,GAAA,CAAA;AAAA,KACxC;AAAA,GACJ;AACA,EAAM,MAAA,kBAAA,GAAqB,CAAC,WAAwB,KAAA;AAChD,IAAM,MAAA,GAAA,GAAM,IAAI,WAAW,CAAA,CAAA;AAC3B,IAAA,IAAI,GAAK,EAAA;AACL,MAAI,IAAA,GAAA,CAAI,KAAM,CAAA,SAAS,CAAG,EAAA;AACtB,QAAO,OAAA,CAAA,YAAA,EAAe,YAAY,CAAA,OAAA,EAAU,GAAG,CAAA,SAAA,EAAY,cAAc,CAAA,OAAA,EAAU,WAAW,CAAA,EAAG,WAAW,CAAA,EAAG,YAAY,CAAA,GAAA,CAAA,CAAA;AAAA,OACxH,MAAA;AACH,QAAO,OAAA,CAAA,cAAA,EAAiB,YAAY,CAAA,OAAA,EAAU,GAAG,CAAA,SAAA,EAAY,cAAc,CAAA,SAAA,EAAY,WAAW,CAAA,EAAG,WAAW,CAAA,EAAG,YAAY,CAAA,0CAAA,CAAA,CAAA;AAAA,OACnI;AAAA,KACG,MAAA;AACH,MAAA,OAAO,CAAG,EAAA,WAAW,CAAG,EAAA,WAAW,GAAG,YAAY,CAAA,CAAA,CAAA;AAAA,KACtD;AAAA,GACJ,CAAA;AACA,EAAA,MAAM,aAAa,CAAC,IAAA,KAAiB,gBAAgB,WAAa,EAAA,YAAA,EAAc,oBAAoB,IAAI,CAAA,CAAA;AAExG,EAAO,OAAA,SAAS,WAAW,SAA6B,EAAA;AACpD,IAAI,IAAA,OAAO,cAAc,QAAU,EAAA;AAC/B,MAAA,OAAO,WAAW,SAAS,CAAA,CAAA;AAAA,KACxB,MAAA;AACH,MAAA,MAAM,MAAM,SAAU,CAAA,SAAA,CAAA;AACtB,MAAM,MAAA,MAAA,GAAS,WAAW,GAAG,CAAA,CAAA;AAC7B,MAAI,IAAA,MAAA,KAAW,GAAK,EAAA,SAAA,CAAU,SAAY,GAAA,MAAA,CAAA;AAAA,KAC9C;AAAA,GACJ,CAAA;AACJ;;;;"}