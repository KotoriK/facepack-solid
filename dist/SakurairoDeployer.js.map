{"version":3,"file":"SakurairoDeployer.js","sources":["../src/SakurairoDeployer.tsx"],"sourcesContent":["import { createSignal, } from 'solid-js'\nimport { render } from 'solid-js/web'\nimport { FacePackage } from '.'\nimport { Peak } from './peak'\nimport { createFaceSelector } from './selector/components/FaceSelector'\n\n/* export function deployRenderer(facePackages: FacePackage[]) {\n    const render = createFaceRenderer({\n        facePackages: facePackages\n    })\n    setStyleSetting(defaultStyle)\n\n    document.querySelectorAll('article.hentry p:not(.ct-respond-form-textarea):not(.form-submit)').forEach(render)\n} */\nexport function deploySelector(facePackages: FacePackage[]) {\n    const emotionBox: HTMLElement | null = document.querySelector<HTMLElement>('.emotion-box')!\n    const commentArea: HTMLTextAreaElement | HTMLInputElement | null = document.querySelector('#comment')!\n    if (emotionBox && commentArea) {\n        document.querySelector('.motion-switcher-table th:last-child')?.insertAdjacentHTML('afterend', `<th onclick=\"motionSwitch('.custom')\" class=\"custom-bar\">YukiCat 特供</th>`)\n        const container = document.createElement('div')\n        container.className = 'custom-container'\n        container.style.cssText = \"display:none;height:110px;overflow-y:auto;width:100%;\"\n        emotionBox.append(container)\n        const [{ inspecting }, FaceSelector] = createFaceSelector()\n/*         const [hide, setHide] = createSignal(true)\n */        const [loadContent, setLoadContent] = createSignal(false)\n\n        render(() => <FaceSelector facePacks={facePackages}\n            loadContent={loadContent()}\n          //  handleHide={() => setHide(true)}\n/*             style={`display:${hide() ? 'none' : 'block'}`}\n */            onSelect={(pack, face) => {\n                // 替换当前选中部分的文本\n                const insertion = `:${pack.id}.${face.id}:`\n                if (commentArea.selectionStart === null) {\n                    return\n                }\n                // from Sakurairo-Script grin()\n                if (commentArea.selectionStart || commentArea.selectionStart === 0) {\n                    const startPos = commentArea.selectionStart,\n                        endPos = commentArea.selectionEnd!\n                    let cursorPos = endPos;\n                    commentArea.value = commentArea.value.substring(0, startPos) + insertion + commentArea.value.substring(endPos, commentArea.value.length);\n                    cursorPos += insertion.length;\n                    commentArea.focus();\n                    commentArea.selectionStart = cursorPos;\n                    commentArea.selectionEnd = cursorPos;\n                } else {\n                    commentArea.value += insertion;\n                    commentArea.focus();\n                }\n                // end quote\n            }} />, container)\n        // init toggler\n        document.getElementById('emotion-toggle')?.addEventListener('click', () => {\n            setLoadContent(true)\n/*             setHide(prev => !prev)\n */        }, { once: true })\n\n        // init Peak\n        const peak = document.createElement('div')\n        document.body.append(peak)\n        render(() => {\n            const imgCaption = () => {\n                const face = inspecting()\n                return face ? (face.descr ?? face.id) : undefined\n            }\n            return <Peak src={inspecting()?.url} descr={imgCaption()} anchor={emotionBox!} />\n        }, peak)\n    }\n}"],"names":["deploySelector","facePackages","emotionBox","document","querySelector","commentArea","insertAdjacentHTML","container","createElement","className","style","cssText","append","inspecting","FaceSelector","createFaceSelector","loadContent","setLoadContent","createSignal","render","_$createComponent","facePacks","onSelect","pack","face","insertion","id","selectionStart","startPos","endPos","selectionEnd","cursorPos","value","substring","length","focus","getElementById","addEventListener","once","peak","body","imgCaption","descr","undefined","Peak","src","url","anchor"],"mappings":"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"}