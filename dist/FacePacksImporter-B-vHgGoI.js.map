{"version":3,"file":"FacePacksImporter-B-vHgGoI.js","sources":["../src/util/importJSON.ts","../src/FacePackage.ts","../src/FacePacksImporter.ts"],"sourcesContent":["export const importJSON =\n    (url: string) => fetch(url)\n        .then(\n            (response) => {\n                if (response.ok) {\n                    return response.json()\n                } else {\n                    throw new Error(`Fetch Error:Return HTTP ${response.status}, ${response.statusText}`)\n                }\n            }\n        )\n","import { processTemplate } from \"./util/template\";\n\nexport interface FacePackage {\n    id: string\n\n    /**\n     * 表情包的友好名称\n     *\n     * @type {string}\n     * @memberof FacePackage\n     */\n    name: string\n    faces: Array<Face>\n    p_url?: string\n    default?: string\n}\nexport interface FacePackageDefine {\n    id: string\n\n    /**\n     * 表情包的友好名称\n     *\n     * @type {string}\n     * @memberof FacePackage\n     */\n    name: string\n    faces: Array<FaceDefine>\n    p_url?: string\n    default?: string\n}\nexport interface Face {\n\n    /**\n     * 与php方互通的表情id\n     *\n     * @type {string}\n     * @memberof Face\n     */\n    id: string\n\n    /**\n     *\n     * 表情的url\n     * @type {string}\n     * @memberof Face\n     */\n    url: string\n\n    /**\n     * 表情描述\n     */\n    descr?: string\n\n}\nexport type FaceDefine = {\n    id: string\n    url?: string\n} | string\nexport function getFaceFullUrl(face: FaceDefine, parentPack: FacePackageDefine | FacePackage) {\n    const _face = typeof face == \"string\" ? { id: face } : face\n    const _process = (ph: string) => processTemplate('{', '}', (str) => {\n        if (str == 'id') {\n            return _face.id\n        } else if (str in parentPack) {\n            return parentPack[str as keyof typeof parentPack] as string\n        } else {\n            return `{${str}}`\n        }\n    }, ph)\n    const { url, ...other_key } = _face\n    return {\n        ...other_key, url: _process(url && _process(url) || parentPack.default!)\n    }\n}","import { importJSON } from './util/importJSON'\nimport { FacePackage, FacePackageDefine, getFaceFullUrl } from './FacePackage'\nexport async function importExternalFacePacks(url: string) {\n    const json: Array<FacePackageDefine> = await importJSON(url)\n    if (json) {\n        preprocessFacePack(json)\n        return json as Array<FacePackage>\n    }\n    throw new Error(`Try to load FacePacks from '${url}' failed.`)\n}\nexport function preprocessFacePack(facepacks: Array<FacePackageDefine>) {\n    for (const pack of facepacks) {\n        pack.faces = pack.faces.map((face) => getFaceFullUrl(face, pack))\n    }\n}"],"names":[],"mappings":";;AAAO,MAAM,UACT,GAAA,CAAC,GAAgB,KAAA,KAAA,CAAM,GAAG,CACrB,CAAA,IAAA;AAAA,EACG,CAAC,QAAa,KAAA;AACV,IAAA,IAAI,SAAS,EAAI,EAAA;AACb,MAAA,OAAO,SAAS,IAAK,EAAA,CAAA;AAAA,KAClB,MAAA;AACH,MAAM,MAAA,IAAI,MAAM,CAA2B,wBAAA,EAAA,QAAA,CAAS,MAAM,CAAK,EAAA,EAAA,QAAA,CAAS,UAAU,CAAE,CAAA,CAAA,CAAA;AAAA,KACxF;AAAA,GACJ;AACJ,CAAA;;ACgDQ,SAAA,cAAA,CAAe,MAAkB,UAA6C,EAAA;AAC1F,EAAA,MAAM,QAAQ,OAAO,IAAA,IAAQ,WAAW,EAAE,EAAA,EAAI,MAAS,GAAA,IAAA,CAAA;AACvD,EAAA,MAAM,WAAW,CAAC,EAAA,KAAe,gBAAgB,GAAK,EAAA,GAAA,EAAK,CAAC,GAAQ,KAAA;AAChE,IAAA,IAAI,OAAO,IAAM,EAAA;AACb,MAAA,OAAO,KAAM,CAAA,EAAA,CAAA;AAAA,KACjB,MAAA,IAAW,OAAO,UAAY,EAAA;AAC1B,MAAA,OAAO,WAAW,GAA8B,CAAA,CAAA;AAAA,KAC7C,MAAA;AACH,MAAA,OAAO,IAAI,GAAG,CAAA,CAAA,CAAA,CAAA;AAAA,KAClB;AAAA,KACD,EAAE,CAAA,CAAA;AACL,EAAA,MAAM,EAAE,GAAA,EAAK,GAAG,SAAA,EAAc,GAAA,KAAA,CAAA;AAC9B,EAAO,OAAA;AAAA,IACH,GAAG,SAAA;AAAA,IAAW,KAAK,QAAS,CAAA,GAAA,IAAO,SAAS,GAAG,CAAA,IAAK,WAAW,OAAQ,CAAA;AAAA,GAC3E,CAAA;AACJ;;ACvEA,eAAsB,wBAAwB,GAAa,EAAA;AACvD,EAAM,MAAA,IAAA,GAAiC,MAAM,UAAA,CAAW,GAAG,CAAA,CAAA;AAC3D,EAAA,IAAI,IAAM,EAAA;AACN,IAAA,kBAAA,CAAmB,IAAI,CAAA,CAAA;AACvB,IAAO,OAAA,IAAA,CAAA;AAAA,GACX;AACA,EAAA,MAAM,IAAI,KAAA,CAAM,CAA+B,4BAAA,EAAA,GAAG,CAAW,SAAA,CAAA,CAAA,CAAA;AACjE,CAAA;AACO,SAAS,mBAAmB,SAAqC,EAAA;AACpE,EAAA,KAAA,MAAW,QAAQ,SAAW,EAAA;AAC1B,IAAK,IAAA,CAAA,KAAA,GAAQ,KAAK,KAAM,CAAA,GAAA,CAAI,CAAC,IAAS,KAAA,cAAA,CAAe,IAAM,EAAA,IAAI,CAAC,CAAA,CAAA;AAAA,GACpE;AACJ;;;;"}